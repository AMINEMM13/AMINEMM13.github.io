<!DOCTYPE html>
<html lang="ko">
<head><meta charset="UTF-8"><title>VideoApp</title>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head><body>
  <h1>VideoApp</h1>
  <p>설치 후 업로드하세요.</p>
  <!-- 설치 후 자동 호스트 리디렉션 덕분에 주소창은 https://aminemm13.github.io -->
  <div id="upload-section">
    <form id="uploadForm" enctype="multipart/form-data">
      <label>텍스트(.txt)</label><input type="file" id="textfile" accept=".txt"><br>
      <label>이미지</label><input type="file" id="images" multiple><br>
      <label>웃음</label><input type="radio" name="laugh" value="1">예
                    <input type="radio" name="laugh" value="2" checked>아니오<br>
      <button type="submit">실행</button>
    </form>
    <div id="progress"><p>0%</p></div>
    <div id="download-section" style="display:none;">
      <a id="downloadLink"><button>다운로드</button></a>
    </div>
  </div>
  <script>
  document.getElementById('uploadForm').addEventListener('submit',async e=>{
    e.preventDefault();
    // 포트 8329에서만 동작하므로, hosts 덕분에 요청은 localhost:8329로 감
    const txt=document.getElementById('textfile').files[0];
    if(!txt||!txt.name.endsWith('.txt')){alert('텍스트 선택');return;}
    const imgs=document.getElementById('images').files;
    const laugh=document.querySelector('input[name="laugh"]:checked').value;
    const fd=new FormData(); fd.append('textfile',txt);
    for(let f of imgs) fd.append('images',f); fd.append('laugh',laugh);
    await axios.post('/',fd);
    const es=new EventSource('/progress');
    es.onmessage=e=>{const p=+e.data; document.getElementById('progress').innerHTML=`<p>${p}%</p>`; 
      if(p===100){es.close();document.getElementById('download-section').style.display='block';
        document.getElementById('downloadLink').href=`/download/${txt.name}`;}
    };
  });
  </script>
</body>
</html>
